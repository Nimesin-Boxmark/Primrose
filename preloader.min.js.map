{"version":3,"file":"preloader.min.js","sources":["preloader/index.js"],"sourcesContent":["const prog = {\r\n  bar: null,\r\n  files: {},\r\n  loaded: 0,\r\n  total: 0,\r\n\r\n  findProgressBar() {\r\n    if(!this.bar){\r\n      this.bar = document.querySelector(\"progress\");\r\n    }\r\n  },\r\n\r\n  shrink(size){\r\n    this.findProgressBar();\r\n    if(this.bar) {\r\n      this.bar.style.height = size;\r\n    }\r\n  },\r\n\r\n  hide() {\r\n    this.findProgressBar();\r\n    if(this.bar) {\r\n      this.bar.style.display = \"none\";\r\n    }\r\n  },\r\n\r\n  thunk(evt) {\r\n    const file = evt.target.responseURL || evt.target.currentSrc;\r\n    if(file){\r\n      if(!this.files[file]){\r\n        this.files[file] = {};\r\n      }\r\n      const f = this.files[file];\r\n      if(typeof evt.loaded === \"number\") {\r\n        f.loaded = evt.loaded;\r\n        f.total = evt.total;\r\n      }\r\n      else if(evt.srcElement) {\r\n        const bs = evt.srcElement.buffered;\r\n        let min = Number.MAX_VALUE,\r\n          max = Number.MIN_VALUE;\r\n        for(let i = 0; i < bs.length; ++i){\r\n          min = Math.min(min, bs.start(i));\r\n          max = Math.max(max, bs.end(i));\r\n        }\r\n        f.loaded = 1000 * max;\r\n        f.total = 1000 * evt.srcElement.duration;\r\n      }\r\n    }\r\n\r\n    let total = 0, loaded = 0;\r\n    for(var key in this.files){\r\n      const f = this.files[key];\r\n      loaded += f.loaded;\r\n      total += f.total;\r\n    }\r\n\r\n    this.loaded = loaded;\r\n    this.total = total;\r\n\r\n    this.findProgressBar();\r\n\r\n    if(this.bar && total){\r\n      this.bar.max = total;\r\n      this.bar.value = loaded;\r\n    }\r\n  }\r\n},\r\n\r\n  curScripts = document.querySelectorAll(\"script\"),\r\n  curScript = curScripts[curScripts.length - 1],\r\n  scripts = [];\r\n\r\n[\"findProgressBar\", \"shrink\", \"hide\", \"thunk\"].forEach((n) => prog[n] = prog[n].bind(prog));\r\n\r\nlet loaded = 0;\r\n\r\nfunction get(file, done) {\r\n  const x = new XMLHttpRequest();\r\n  x.onload = done && function(){ done(x.response); }\r\n  x.onprogress = prog && prog.thunk;\r\n  x.open(\"GET\", file);\r\n  x.send();\r\n}\r\n\r\nfunction installScripts() {\r\n  if(!document.body){\r\n    setTimeout(installScripts, 0);\r\n  }\r\n  else if(window.DEBUG) {\r\n    if(scripts.length > 0) {\r\n      const file = scripts.shift(),\r\n        s = document.createElement(\"script\");\r\n      s.src = file;\r\n      s.onload = installScripts;\r\n      document.body.appendChild(s);\r\n    }\r\n  }\r\n  else{\r\n    const s = document.createElement(\"script\");\r\n    s.innerHTML = scripts.join(\"\\n\");\r\n    document.body.appendChild(s);\r\n  }\r\n}\r\n\r\nfunction getNextScript(file, i, arr) {\r\n  get(file, (contents) => {\r\n    if(window.DEBUG) {\r\n      scripts[i] = file;\r\n    }\r\n    else{\r\n      scripts[i] = contents;\r\n    }\r\n    ++loaded;\r\n    if(loaded === arr.length) {\r\n      installScripts();\r\n    }\r\n  });\r\n}\r\n\r\nif(!window.PRIMROSE_TELEMETRY_OPT_OUT) {\r\n  get(\"https://www.primrosevr.com/telemetry\");\r\n}\r\n\r\nif(curScript && curScript.dataset.files) {\r\n  curScript.dataset.files.split(\",\").forEach(getNextScript);\r\n}\r\n\r\nexport default prog;\r\n"],"names":["x","XMLHttpRequest","onload","done","response","onprogress","prog","thunk","open","send","document","body","window","DEBUG","s","createElement","innerHTML","scripts","join","appendChild","length","file","shift","src","bar","querySelector","findProgressBar","style","height","display","evt","target","responseURL","currentSrc","files","f","loaded","total","srcElement","bs","buffered","min","Number","MAX_VALUE","max","MIN_VALUE","i","Math","start","end","duration","key","value","curScripts","querySelectorAll","curScript","forEach","bind","PRIMROSE_TELEMETRY_OPT_OUT","dataset","split","arr"],"mappings":"sLA6EA,eAAyB,IACjBA,GAAI,GAAIC,kBACZC,OAASC,GAAQ,UAAU,GAAOH,EAAEI,SAAtC,CAFuB,GAGrBC,WAAaC,GAAQA,EAAKC,KAHL,GAIrBC,KAAK,QAJgB,GAKrBC,OAGJ,YAA0B,IACrB,CAACC,SAASC,kBACgB,OAExB,KAAGC,OAAOC,KAAV,CASD,IACIC,GAAIJ,SAASK,aAATL,CAAuB,QAAvBA,IACRM,UAAYC,EAAQC,IAARD,CAAa,IAAbA,CAFZ,UAGON,KAAKQ,eAZX,QACiB,CAAjBF,GAAQG,OAAY,IACfC,GAAOJ,EAAQK,KAARL,GACXH,EAAIJ,SAASK,aAATL,CAAuB,QAAvBA,IACJa,KAHmB,GAInBrB,QAJmB,UAKZS,KAAKQ,gBA/FpB,GAAMb,GAAO,KACN,IADM,SAAA,QAGH,CAHG,OAIJ,CAJI,2BAMO,CACZ,KAAKkB,GADO,QAETA,IAAMd,SAASe,aAATf,CAAuB,UAAvBA,CAFG,CANP,CAAA,mBAYC,MACLgB,iBADK,CAEP,KAAKF,GAFE,QAGHA,IAAIG,MAAMC,QAHP,CAZD,CAAA,gBAmBJ,MACAF,iBADA,CAEF,KAAKF,GAFH,QAGEA,IAAIG,MAAME,QAAU,MAHtB,CAnBI,CAAA,kBA0BA,IACHR,GAAOS,EAAIC,MAAJD,CAAWE,WAAXF,EAA0BA,EAAIC,MAAJD,CAAWG,gBAC1C,CACF,KAAKC,KAAL,GADE,QAECA,WAFD,KAIAC,GAAI,KAAKD,KAAL,OACe,QAAtB,QAAOJ,GAAIM,SACVA,OAASN,EAAIM,SACbC,MAAQP,EAAIO,UAEX,IAAGP,EAAIQ,UAAP,CAAmB,KAIlB,GAHEC,GAAKT,EAAIQ,UAAJR,CAAeU,QAGtB,CAFAC,EAAMC,OAAOC,SAEb,CADFC,EAAMF,OAAOG,SACX,CAAIC,EAAI,EAAGA,EAAIP,EAAGnB,OAAQ,MACtB2B,KAAKN,GAALM,GAAcR,EAAGS,KAAHT,GAAdQ,IACAA,KAAKH,GAALG,GAAcR,EAAGU,GAAHV,GAAdQ,IAENX,OAAS,KARW,GASpBC,MAAQ,IAAOP,EAAIQ,UAAJR,CAAeoB,aAIhCb,GAAQ,EAAGD,EAAS,MACpB,GAAIe,KAAO,MAAKjB,MAAM,IAClBC,GAAI,KAAKD,KAAL,OACAC,EAAEC,MAFY,IAGfD,EAAEE,WAGRD,QA/BI,MAgCJC,OAhCI,MAkCJX,iBAlCI,CAoCN,KAAKF,GAAL,GApCM,QAqCFA,IAAIoB,KArCF,MAsCFpB,IAAI4B,OAtCF,EA1BA,CAAb,CAqEEC,EAAa3C,SAAS4C,gBAAT5C,CAA0B,QAA1BA,CArEf,CAsEE6C,EAAYF,EAAWA,EAAWjC,MAAXiC,CAAoB,CAA/BA,CAtEd,CAuEEpC,IAvEF,CAyEA,4CAA+CuC,OAA/C,CAAuD,kBAAOlD,MAAUA,KAAQmD,IAARnD,GAAxE,CAAA,EAEA,GAAI8B,GAAS,CAAb,OA6CIxB,QAAO8C,8BACL,wCAGHH,GAAaA,EAAUI,OAAVJ,CAAkBrB,SACtByB,QAAQzB,MAAM0B,MAAM,KAAKJ,QApBrC,eAAqC,KACzB,WAAc,KAAA,CACnB5C,OAAOC,KADY,QAAA,CAQnBuB,IAAWyB,EAAIzC,MARI,KAAxB"}